{% extends "main/base.html" %}
{% load static %}

{% block content %}
<h2>Аналитика по {{ org.name }}</h2>
<p>Общая сумма расходов: <b>{{ total_expenses }}</b> ₽</p>

<div class="row mb-4">
  <div class="col-md-6">
    <h4>Динамика расходов (помесячно за год):</h4>
    <canvas id="monthChart" width="400" height="200"></canvas>
  </div>
  <div class="col-md-6">
    <h4>Распределение расходов по категориям:</h4>
    <canvas id="catChart" width="300" height="300"></canvas>
  </div>
</div>

<!-- Скрытые теги для хранения JSON-данных -->
<script type="application/json" id="monthLabelsJSON">
  {{ month_labels_json|safe }}
</script>
<script type="application/json" id="monthValuesJSON">
  {{ month_values_json|safe }}
</script>
<script type="application/json" id="catLabelsJSON">
  {{ cat_labels_json|safe }}
</script>
<script type="application/json" id="catValuesJSON">
  {{ cat_values_json|safe }}
</script>

{% endblock %}

{% block extra_js %}
<!-- Подключаем Chart.js из CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<!-- Подключаем наш внешний скрипт -->
<script src="{% static 'js/analytics.js' %}"></script>
{% endblock %}
